#!/usr/bin/env/python
import os
import re
import sys
mk = file('MochiKit/MochiKit.js').read()
outf = file('packed/MochiKit/MochiKit.js', 'w')
VERSION = re.search(
    r"""(?mxs)MochiKit.MochiKit.VERSION\s*=\s*['"]([^'"]+)""",
    mk
).group(1)
SUBMODULES = (["Compat"] + map(str.strip, re.search(
    r"""(?mxs)MochiKit.MochiKit.SUBMODULES\s*=\s*\[([^\]]+)""",
    mk
).group(1).replace(' ', '').replace('"', '').split(',')))
DECOMMENT = re.compile(r"""(?mxs)(/\*\*\*.*?\*\*\*/)""")
alltext = '\n'.join(
    [file('MochiKit/%s.js' % m).read() for m in SUBMODULES]
    + [mk])
alltext = DECOMMENT.sub('', alltext)
print >>outf, """/***

    MochiKit.MochiKit %(VERSION)s : PACKED VERSION

    THIS FILE IS AUTOMATICALLY GENERATED.  If creating patches, please
    diff against the source tree, not this file.

    See <http://mochikit.com/> for documentation, downloads, license, etc.

    (c) 2005 Bob Ippolito.  All rights Reserved.

***/
""" % locals()
print >>outf, alltext
outf.flush()
outf.close()
